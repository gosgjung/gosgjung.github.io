---
title: 주요 업무 경험
author: Soon Good Jung
date: 2022-12-06
category: Jekyll
layout: post
---



# 로컬 테스트 환경 구축 경험

> 웨이커, 증권데이터 처리 서버 개발

<br>

- 레피니티브라고 벤더사에서 제공하는 거래 데이터 API 에서 제공하는 거래 데이터는 거래시각/거래가격 등의 필드들을 모호하게 보내주는 경우가 많습니다.

- 예를 들면 미국주식에서는 거래시각이라는 필드명이 `SALTIM_MS` 라고 하는 필드로 전달해주지만, 특정 ETF 는 `SALTIM` 이라는 필드로만 내려오는 경우도 있습니다. 이런 현상은 미국주식 외에도 ETF,채권, 중국주식, 지수 등의 데이터에도 무분별하게 발생했습니다.

- 이런 현상을 해결하려면, 개발용도의 메시지 큐를 개설하는 작업이 필요했는데, 그 당시의 인프라팀의 데브옵스 엔지니어들은 근무 태만이 심하기도 했고, 개발 용도의 메시지 큐 개설에 대해 전혀 이해를 못하는 상황이라 3개월 정도 설득을 거쳤고, 그 전 까지는 로컬 환경에서 `raw` 데이터를 명시적으로 검증할 수 있는 환경을 마련해야 했습니다.

- 이와 같은 현상을 해결하기 위해 매핑 룰을 객체지향적으로 구성해, 모호하게 내려오는 필드명을 매칭 시키는 소프트웨어 로직을 작성하는 작업도 수행했고, 이것을 검증하기 위해 로컬 테스트 환경을 구축했습니다.

- 쉽게 설명하면, 실제 라이브 데이터의 로그를 추출하고, 추출한 로그에서 json 덤프를 만들고, 이 json 덤프를 통해 필드 매핑을 테스트하는 구조의 테스트 환경이었습니다.

<br>

증권 데이터 서버 개발 시에는 인프라 팀의 데브옵스 관계자들을 설득하는데에 꽤 어려움을 겪었습니다. 증권 데이터의 트래픽 데이터를 중계해주는 개발용도의 메시지 큐 서버를 구성해야 했는데, 인프라 팀 구성원을 설득하는 데에 3개월 이상을 설득하고 나서야 개발 용도의 메시지 큐를 개설할 수 있었습니다.

이런 이유로 개발 서버 구성 전 까지는 개발용도의 메시징 서버 없이 소스코드 레벨에서 TCP/IP 통신 시에 주고 받는 raw 데이터의 각 필드 매핑에 대한 검증 작업이 필요했습니다. 이 외에도 증권 데이터 API 의 raw 데이터 매핑(거래시각, 시가/고자/종가/저가 등의 필드)들도 직접 모두 일일이 파악해야 했습니다.

예를 들면 시간 외 거래 데이터를 파악하기 위해서는 시간 외 데이터가 보내주는 거래시각, 가격데이터가 필요합니다. 증권데이터는 이 필드 명이 모호하게 전달되고 개발자 문서를 제공하지 않기에 직접 API 사용자가 필드를 파악해서 매핑하는 것이 증권 데이터 개발에서의 핵심적인 업무입니다.

이런 문제를 해결하기 위해 직접 상용데이터의 로그를 남기는 로직과 이 로그를 json 으로 변환하는 로직을 만들었고, 이 json 데이터를 기반으로 데이터 매핑을 검증하는 테스트 코드를 구현해, 배포시에 직접 파악한 raw 데이터의 필드 매핑이 올바른지 검증할 수 있도록 테스트 환경을 구축했었습니다.

이와 같은 문제는 시간 외 거래 뿐만이 아니라, ETF, 채권, 환율, 지수 등 각 데이터마다 제각각 이었기에 소프트웨어적으로도 매핑을 하는 룰 역할의 클래스를 객체지향적으로 설계하는 것부터 시작해 RAW 데이터를 꼼꼼하게 파악헤 테스트 케이스로 남겨두어 소스코드 레벨에서 명세화 하는 작업이 중요했습니다.

테스트가 필요할 경우에 대해 테스트의 범위를 적절하게 선정해 명시적으로 올바른 코드임을 보장하는 테스트 케이스 또는 테스트 환경을 구축해보고 싶습니다.

